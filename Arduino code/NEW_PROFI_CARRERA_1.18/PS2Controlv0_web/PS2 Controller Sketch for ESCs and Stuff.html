<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0137)file:///C:/Users/irwin/Documents/Irwin/Concordia/Mech_471/Mech_471_Rc_Drift_Car/PS2%20Controller%20Sketch%20for%20ESCs%20and%20Stuff.html -->
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

  
  
  <title>PS2 Controller Sketch for ESCs and Stuff</title>
<link href="./PS2 Controller Sketch for ESCs and Stuff_files/style.css" rel="stylesheet" type="text/css" media="screen">
<link href="file:///C:/Users/irwin/Documents/Irwin/Concordia/Mech_471/Mech_471_Rc_Drift_Car/PS2%20Controller%20Sketch%20for%20ESCs%20and%20Stuff_files/pygments.css" rel="stylesheet" type="text/css" media="screen">
<link href="http://www.techmonkeybusiness.com/" type="application/atom+xml" rel="alternate" title="TechMonkeyBusiness ATOM Feed">
<link href="http://www.techmonkeybusiness.com/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="TechMonkeyBusiness RSS Feed">
  
  <!--[if IE]>
  <style type="text/css"> 
  .twoColFixRtHdr #mainContent { zoom: 1; }
  </style>
  <![endif]-->

</head>

<body>

<div id="container">

  <div id="header">
  <h1><a href="http://www.techmonkeybusiness.com/">TechMonkeyBusiness</a></h1><a href="http://www.techmonkeybusiness.com/">
  
  </a></div><!-- end #header --><a href="http://www.techmonkeybusiness.com/">
  
  </a><div id="topMenu"><a href="http://www.techmonkeybusiness.com/">
  
    </a><ul><a href="http://www.techmonkeybusiness.com/">
    	</a><li><a href="http://www.techmonkeybusiness.com/"></a><a href="http://www.techmonkeybusiness.com/index.html">Home</a></li>
        <li>–</li>
        <li><a href="http://www.techmonkeybusiness.com/archives.html">Archives</a></li>
        
    </ul>
  
  </div><!-- end #topMenu -->

  <div id="sidebar">
	<h3>Pages</h3>
	<ul>
            <li><a href="http://www.techmonkeybusiness.com/pages/about-me.html">About Me</a></li>
            <li><a href="http://www.techmonkeybusiness.com/pages/art-projects.html">Art Projects</a></li>
            <li><a href="http://www.techmonkeybusiness.com/pages/models-and-games.html">Models and Games</a></li>
            <li><a href="http://www.techmonkeybusiness.com/pages/random-stuff.html">Random Stuff</a></li>
            <li><a href="http://www.techmonkeybusiness.com/pages/tech-projects.html">Tech Projects</a></li>
            <li><a href="http://www.techmonkeybusiness.com/pages/tutorials.html">Tutorials</a></li>
            <li><a href="http://www.techmonkeybusiness.com/pages/whats-new.html">What's New</a></li>
            <li><a href="http://www.techmonkeybusiness.com/">Welcome</a></li>
	</ul>
    <h3>Categories</h3>
    <ul>
		 <li><a href="http://www.techmonkeybusiness.com/category/art-projects.html">Art Projects</a></li>
		 <li><a href="http://www.techmonkeybusiness.com/category/essays.html">Essays</a></li>
		 <li><a href="http://www.techmonkeybusiness.com/category/food-and-wine.html">Food and Wine</a></li>
		 <li><a href="http://www.techmonkeybusiness.com/category/models-and-games.html">Models and Games</a></li>
		 <li><a href="http://www.techmonkeybusiness.com/category/random.html">Random</a></li>
		 <li><a href="http://www.techmonkeybusiness.com/category/rc-gear.html">RC Gear</a></li>
		 <li class="active"><a href="http://www.techmonkeybusiness.com/category/tech-projects.html">Tech Projects</a></li>
		 <li><a href="http://www.techmonkeybusiness.com/category/tutorials.html">Tutorials</a></li>
	</ul>
      
	<li>
		<h3>Tags</h3>
		<ul>
		<tagstyle>
			<a href="http://www.techmonkeybusiness.com/tag/essay.html">Essay, </a>
			<a href="http://www.techmonkeybusiness.com/tag/playstation.html">Playstation, </a>
			<a href="http://www.techmonkeybusiness.com/tag/godot.html">Godot, </a>
			<a href="http://www.techmonkeybusiness.com/tag/art.html">Art, </a>
			<a href="http://www.techmonkeybusiness.com/tag/3d-printing.html">3D Printing, </a>
			<a href="http://www.techmonkeybusiness.com/tag/instruments.html">instruments, </a>
			<a href="http://www.techmonkeybusiness.com/tag/energy.html">Energy, </a>
			<a href="http://www.techmonkeybusiness.com/tag/robotics.html">Robotics, </a>
			<a href="http://www.techmonkeybusiness.com/tag/recipe.html">Recipe, </a>
			<a href="http://www.techmonkeybusiness.com/tag/rc-aircraft.html">RC Aircraft, </a>
			<a href="http://www.techmonkeybusiness.com/tag/themes.html">Themes, </a>
			<a href="http://www.techmonkeybusiness.com/tag/ps2.html">PS2, </a>
			<a href="http://www.techmonkeybusiness.com/tag/vr.html">VR, </a>
			<a href="http://www.techmonkeybusiness.com/tag/mindstorms.html">Mindstorms, </a>
			<a href="http://www.techmonkeybusiness.com/tag/stopmotion.html">Stopmotion, </a>
			<a href="http://www.techmonkeybusiness.com/tag/serial.html">Serial, </a>
			<a href="http://www.techmonkeybusiness.com/tag/tools.html">Tools, </a>
			<a href="http://www.techmonkeybusiness.com/tag/rov.html">ROV, </a>
			<a href="http://www.techmonkeybusiness.com/tag/blender.html">Blender, </a>
			<a href="http://www.techmonkeybusiness.com/tag/freecad.html">FreeCAD, </a>
			<a href="http://www.techmonkeybusiness.com/tag/gis.html">GIS, </a>
			<a href="http://www.techmonkeybusiness.com/tag/alcohol.html">Alcohol, </a>
			<a href="http://www.techmonkeybusiness.com/tag/arduino.html">Arduino, </a>
			<a href="http://www.techmonkeybusiness.com/tag/qgis.html">QGIS, </a>
			<a href="http://www.techmonkeybusiness.com/tag/openscad.html">OpenSCAD, </a>
			<a href="http://www.techmonkeybusiness.com/tag/celestia.html">Celestia, </a>
			<a href="http://www.techmonkeybusiness.com/tag/models.html">Models, </a>
			<a href="http://www.techmonkeybusiness.com/tag/workshop.html">Workshop, </a>
			<a href="http://www.techmonkeybusiness.com/tag/music.html">music, </a>
			<a href="http://www.techmonkeybusiness.com/tag/inkscape.html">Inkscape, </a>
			<a href="http://www.techmonkeybusiness.com/tag/communication.html">Communication, </a>
			<a href="http://www.techmonkeybusiness.com/tag/esc.html">ESC, </a>
			<a href="http://www.techmonkeybusiness.com/tag/electronics.html">Electronics, </a>
			<a href="http://www.techmonkeybusiness.com/tag/csv.html">CSV, </a>
			<a href="http://www.techmonkeybusiness.com/tag/bread.html">Bread, </a>
			<a href="http://www.techmonkeybusiness.com/tag/textures.html">Textures, </a>
			<a href="http://www.techmonkeybusiness.com/tag/imagemagick.html">ImageMagick, </a>
			<a href="http://www.techmonkeybusiness.com/tag/servo.html">Servo, </a>
			<a href="http://www.techmonkeybusiness.com/tag/python.html">Python, </a>
			<a href="http://www.techmonkeybusiness.com/tag/camera.html">Camera, </a>
			<a href="http://www.techmonkeybusiness.com/tag/pressure.html">Pressure, </a>
			<a href="http://www.techmonkeybusiness.com/tag/simulators.html">Simulators, </a>
			<a href="http://www.techmonkeybusiness.com/tag/transmitters.html">Transmitters, </a>
			<a href="http://www.techmonkeybusiness.com/tag/thrusters.html">Thrusters, </a>
			<a href="http://www.techmonkeybusiness.com/tag/graphics.html">Graphics, </a>
			<a href="http://www.techmonkeybusiness.com/tag/sculptris.html">Sculptris, </a>
			<a href="http://www.techmonkeybusiness.com/tag/sensors.html">Sensors, </a>
			<a href="http://www.techmonkeybusiness.com/tag/seals.html">Seals, </a>
			<a href="http://www.techmonkeybusiness.com/tag/ceramics.html">Ceramics, </a>
			<a href="http://www.techmonkeybusiness.com/tag/renewable.html">Renewable, </a>
			<a href="http://www.techmonkeybusiness.com/tag/temperature.html">Temperature, </a>
			<a href="http://www.techmonkeybusiness.com/tag/planet.html">Planet, </a>
			<a href="http://www.techmonkeybusiness.com/tag/carrara.html">Carrara, </a>
			<a href="http://www.techmonkeybusiness.com/tag/turbocad.html">TurboCAD, </a>
			<a href="http://www.techmonkeybusiness.com/tag/science.html">science, </a>
			<a href="http://www.techmonkeybusiness.com/tag/scribus.html">Scribus, </a>
			<a href="http://www.techmonkeybusiness.com/tag/lego.html">Lego, </a>
			<a href="http://www.techmonkeybusiness.com/tag/map-making.html">Map Making, </a>
			<a href="http://www.techmonkeybusiness.com/tag/mbot.html">mBot, </a>
			<a href="http://www.techmonkeybusiness.com/tag/sketchup.html">SketchUp, </a>
			<a href="http://www.techmonkeybusiness.com/tag/games.html">games, </a>
			<a href="http://www.techmonkeybusiness.com/tag/gthumb.html">Gthumb, </a>
			<a href="http://www.techmonkeybusiness.com/tag/cake.html">Cake, </a>
			<a href="http://www.techmonkeybusiness.com/tag/i2c.html">I2C, </a>
			<a href="http://www.techmonkeybusiness.com/tag/sculpture.html">Sculpture, </a>
			<a href="http://www.techmonkeybusiness.com/tag/travel.html">Travel, </a>
		</tagstyle>
		</ul>
	</li>
          
  
  </div><!-- end #sidebar -->

  <div id="mainContent">
  	
 


<div class="blogItem">
    
      <h2><a href="http://www.techmonkeybusiness.com/ps2-controller-sketch-for-escs-and-stuff.html">PS2 Controller Sketch for ESCs and Stuff</a></h2>
      <h3>Le Wed 22 October 2014</h3>
      
  <p>The ideal controller for this <a href="http://www.techmonkeybusiness.com/opensource-rov.html">ROV</a> is a wired Playstation 2 controller.  Luckily they are still made and there is a library for the Arduino to talk to them.  It is also possible to <a href="http://www.robotshop.com/">buy sockets for the Playstation 2 controller</a> to plug into without having to make any modifications to the controller. </p>
<p>This sketch is a development to test the use of the wired Playstation 2 controller for driving a series of servos and LEDs.  The Servos are stand-ins for the ESCs that would be used in reality.  The LEDs are used to simulate camera triggers and status as well as pretend to be the main lights.  </p>
<p>A more detailed article on using Playstation2 Controllers for Arduino projects is available on the <a href="http://www.techmonkeybusiness.com/using-a-playstation-2-controller-with-your-arduino-project.html">"<strong><em>Using A Playstation 2 Controller with your Arduino Project</em></strong>"</a>page.  </p>
<p>The sketch has been set up for easy splitting into the two sections; one for the Top-Side master Arduino and one for the ROV Slave Arduino with a series of variables being sent between the two to carry the control commands.  </p>
<p>In this case an Arduino Uno has been used.  </p>
<p>The coding makes use of the PS2X library developed by Bill Porter. See <a href="http://www.billporter.info/">www.billporter.info</a> for the latest from Bill Porter and to download the library.  The example sketch with the library gives an excellent demonstration of the many different ways of interacting with the controller and many functions that I was unaware existed.  </p>
<p>The needs for this project with regards to reading the PS2 controller are fairly simple compared to what input methods are available.  I have made use of;<br>
  * the <code>.Button()</code> function which registers when a button is pressed and held.  This is useful for the camera pitch control.<br>
  * the <code>.ButtonPressed()</code> function which just registers when the button is pressed but does not recognise when it is held.  This is useful for the toggle functions such as the camera recording on/off, the main headlights ON/OFF, and the take-a-photo button.<br>
  * the <code>.Analog()</code> function which is simply for reading the analogue sticks.  </p>
<p>The names Bill Porter has given for all of the buttons and sticks are very logical and the example sketch with his PSX library makes use of them all.  The diagram below identifies the labels used by the PS2X library.  </p>
<p><img alt="PS2 Button IDs in the PSX library" src="./PS2 Controller Sketch for ESCs and Stuff_files/PS2_Controller_PSX_Lib_Labels.png">  </p>
<p>There is a variation of the above with “PSAB” substituted for the “PSB” for some of the buttons that allow the user to get input from how hard the buttons are pressed.  For example PSAB_BLUE measures the amount of pressure applied to the X-button.  This is very cool but not necessary for the needs of this project.  </p>
<h1>The Pin Assignments</h1>
<p>3.3V output to PS2 red Pin<br>
5V output to 1kΩ pull up resistors for PS2.<br>
Pin D10 to PS2 yellow pin<br>
Pin D11 to PS2 orange pin<br>
Pin D12 to PS2 brown pin<br>
Pin D13 to PS2 blue pin  </p>
<p>Pin D2 to LED Camera Photo Trigger<br>
Pin D3 to LED Camera Record Indicator<br>
Pin D4 to LED Main Lights  </p>
<p>Pin D5 to Servo Up Left<br>
Pin D6 to Servo Up right<br>
Pin D7 to Servo Horiz Left<br>
Pin D8 to Servo Horiz Right<br>
Pin D9 to Servo Cam Pitch  </p>
<p>External 5V power supply is providing to the Servo Voltage Line  </p>
<h1>Controls for the ROV</h1>
<p>The controls for the ROV will be<br>
Left Stick: X-axis = Roll, Y-axis = Up/down<br>
Right Stick: X-axis = Yaw, Y-axis = forward/back<br>
Direction button pad left = LED Main lights On/Off toggle<br>
Direction button pad up = Turn camera upwards<br>
Direction button pad down = Turn camera downwards<br>
Triangle = Start/Stop video recording<br>
Circle = Take photo  </p>
<h1>Circuit</h1>
<p><a href="http://www.techmonkeybusiness.com/images/Tech/PS2_Servo_Control.png"><img alt="PS2 Controller, Arduino, and Servo Circuit" src="./PS2 Controller Sketch for ESCs and Stuff_files/PS2_Servo_Control-sml.png"></a><br>
Click on the image or <a href="http://www.techmonkeybusiness.com/images/Tech/PS2_Servo_Control.png">here</a> for a higher resolution image.  </p>
<h1>The Code</h1>
<p>The sketch below can be downloaded from here: <a href="http://www.techmonkeybusiness.com/Code/ROVPS2ControlTest1.ino"><strong>ROVPS2ControlTest1.ino</strong></a>  </p>
<p>You can also download the PS2X library from the following webpage: <a href="http://www.techmonkeybusiness.com/arduino-library-collection.html"><strong>A Collection of Arduino Libraries Used in This Project</strong></a>.  </p>
<div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm">ROVPS2ControlTest1.ino</span>

<span class="cm">This development sketch seeks to simulate the Playstation 2 control</span>
<span class="cm">of the ESCs and servos of the ROV.  LEDs are used to stand in for</span>
<span class="cm">the main LED, the Camera recording function and photographing trigger.</span>

<span class="cm">Pin assignments are:</span>

<span class="cm">3.3V output to PS2 red Pin</span>
<span class="cm">5V output to 1Kohm pull up resistors for PS2.</span>
<span class="cm">Pin D10 to PS2 yellow pin</span>
<span class="cm">Pin D11 to PS2 orange pin</span>
<span class="cm">Pin D12 to PS2 brown pin</span>
<span class="cm">Pin D13 to PS2 blue pin</span>

<span class="cm">Pin D2 to LED Camera Photo Trigger  </span>
<span class="cm">Pin D3 to LED Camera Record Indicator</span>
<span class="cm">Pin D4 to LED Main Lights</span>

<span class="cm">Pin D5 to Servo Up Left</span>
<span class="cm">Pin D6 to Servo Up right</span>
<span class="cm">Pin D7 to Servo Horiz Left</span>
<span class="cm">Pin D8 to Servo Horiz Right</span>
<span class="cm">Pin D9 to Servo Cam Pitch</span>

<span class="cm">External 5V powersupply is providing to the Servo Voltage Line</span>

<span class="cm">The coding pulls on the PS2X library developed by Bill Porter.</span>
<span class="cm">See www.billporter.info for the latest from Bill Porter and to</span>
<span class="cm">download the library.</span>

<span class="cm">While the readings from the controller could be plopped straight into</span>
<span class="cm">the servo commands, variable will be used to hold the values so</span>
<span class="cm">that it will simulate the data packages that will be sent to the</span>
<span class="cm">ROV arduino over the serial eventually.</span>

<span class="cm">The controls for the ROV will be</span>
<span class="cm">Left Stick - X-axis = Roll, Y-axis = Up/down</span>
<span class="cm">Right Stick - X-axis = Yaw, Y-axis = forward/back</span>
<span class="cm">Direction button pad left = LED Main lights On/Off toggle</span>
<span class="cm">Direction button pad up = turn camera upwards</span>
<span class="cm">Direction button pad down = turn camera downwards</span>
<span class="cm">Triangle = Start/Stop video recording</span>
<span class="cm">Circle = Take photo</span>

<span class="cm">*/</span>


<span class="cp">#include</span> <span class="cpf">&lt;Servo.h&gt;  //For driving the ESCs and Servos</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;PS2X_lib.h&gt; // Bill Porter's PS2X Library</span><span class="cp"></span>

<span class="n">PS2X</span> <span class="n">ps2x</span><span class="p">;</span>  <span class="c1">//The PS2 Controller Class</span>
<span class="n">Servo</span> <span class="n">UpLServo</span><span class="p">;</span>  <span class="c1">//Create servo object representing up left ESC</span>
<span class="n">Servo</span> <span class="n">UpRServo</span><span class="p">;</span>  <span class="c1">//Create servo object representing up right ESC</span>
<span class="n">Servo</span> <span class="n">HorizLServo</span><span class="p">;</span>  <span class="c1">//Create servo object representing horiz left ESC</span>
<span class="n">Servo</span> <span class="n">HorizRServo</span><span class="p">;</span>  <span class="c1">//Create servo object representing horiz right ESC</span>
<span class="n">Servo</span> <span class="n">CamServo</span><span class="p">;</span>  <span class="c1">//Create servo object representing camera pitch</span>

<span class="k">const</span> <span class="kt">int</span> <span class="n">grnLEDpin</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>  <span class="c1">//green LED is on Digital pin 12</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">redLEDpin</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>  <span class="c1">//red LED is on Digital pin 13.</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">yelLEDpin</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>  <span class="c1">//yellow LED is on Digital pin 2</span>

<span class="k">volatile</span> <span class="n">boolean</span> <span class="n">CamRec</span><span class="p">;</span>  <span class="c1">//Camera record function toggle</span>
<span class="k">volatile</span> <span class="n">boolean</span> <span class="n">LEDHdlts</span><span class="p">;</span> <span class="c1">//LED headlights on/off toggle</span>

<span class="kt">int</span> <span class="n">ForwardVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">//Value read off the PS2 Right Stick up/down.</span>
<span class="kt">int</span> <span class="n">YawLeftVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">//Value read off the PS2 Right Stick left/right</span>
<span class="kt">int</span> <span class="n">UpVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//Value read off the PS2 Left Stick up/down</span>
<span class="kt">int</span> <span class="n">RollLeftVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// Value read off the PS2 Left Stick left/right</span>
<span class="kt">int</span> <span class="n">CamPitch</span> <span class="o">=</span> <span class="mi">90</span><span class="p">;</span> <span class="c1">//Angle of the camera servo.</span>

<span class="kt">int</span> <span class="n">CamPhotoInd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// a counter for controlling the camera trigger indicator</span>

<span class="kt">int</span> <span class="n">upLraw</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>  <span class="c1">//Variables to carry the actual raw data for the ESCs</span>
<span class="kt">int</span> <span class="n">upRraw</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">HLraw</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">HRraw</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">ps2x</span><span class="p">.</span><span class="n">config_gamepad</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
  <span class="c1">//setup pins and settings: GamePad(clock, command, attention, data, Pressures?, Rumble?)</span>
  <span class="c1">//We have disabled the pressure sensitivity and rumble in this instance and</span>
  <span class="c1">//we know the controller type so we have not bothered with the error checks</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">grnLEDpin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>  <span class="c1">//Sets the grnLEDpin to output</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">redLEDpin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>  <span class="c1">//Sets the redLEDpin to output</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">yelLEDpin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>  <span class="c1">//Sets the yelLEDpin to output.</span>
  <span class="n">CamRec</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>  <span class="c1">//Sets the Camera default to not recording</span>
  <span class="n">UpLServo</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span><span class="c1">// attaches the Up left Servo to pin 5</span>
  <span class="n">UpRServo</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">6</span><span class="p">);</span><span class="c1">// attaches the Up Right Servo to pin 6</span>
  <span class="n">HorizLServo</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">7</span><span class="p">);</span><span class="c1">// attaches the Horizontal Left Servo to pin 7</span>
  <span class="n">HorizRServo</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span><span class="c1">// attaches the Horizontal Right Servo to pin 8</span>
  <span class="n">CamServo</span><span class="p">.</span><span class="n">attach</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span> <span class="c1">// Attaches the Camera Pitch Servo to pin 9.</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">ps2x</span><span class="p">.</span><span class="n">read_gamepad</span><span class="p">();</span> <span class="c1">//This needs to be called at least once a second</span>
                        <span class="c1">// to get data from the controller.</span>
  <span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_PAD_UP</span><span class="p">))</span>  <span class="c1">//Pressed and held</span>
  <span class="p">{</span>
    <span class="n">CamPitch</span> <span class="o">=</span> <span class="n">CamPitch</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//increase the camera pitch</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonPressed</span><span class="p">(</span><span class="n">PSB_PAD_LEFT</span><span class="p">))</span>  <span class="c1">//Pressed</span>
  <span class="p">{</span>
    <span class="n">LEDHdlts</span> <span class="o">=</span> <span class="o">!</span><span class="n">LEDHdlts</span><span class="p">;</span> <span class="c1">//Toggle the LED light flag</span>
  <span class="p">}</span>


  <span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">Button</span><span class="p">(</span><span class="n">PSB_PAD_DOWN</span><span class="p">))</span>  <span class="c1">//Pressed and Held</span>
  <span class="p">{</span>
    <span class="n">CamPitch</span> <span class="o">=</span> <span class="n">CamPitch</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//increase the camera pitch</span>
  <span class="p">}</span>


  <span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonPressed</span><span class="p">(</span><span class="n">PSB_GREEN</span><span class="p">))</span>  <span class="c1">//Triangle pressed</span>
  <span class="p">{</span>
    <span class="n">CamRec</span> <span class="o">=</span> <span class="o">!</span><span class="n">CamRec</span><span class="p">;</span> <span class="c1">//Toggle the Camera recording Status</span>
  <span class="p">}</span>

  <span class="k">if</span><span class="p">(</span><span class="n">ps2x</span><span class="p">.</span><span class="n">ButtonPressed</span><span class="p">(</span><span class="n">PSB_RED</span><span class="p">))</span>  <span class="c1">//Circle pressed</span>
  <span class="p">{</span>
    <span class="n">CamPhotoInd</span> <span class="o">=</span> <span class="mi">70</span><span class="p">;</span>  <span class="c1">//Set to indicate photo taken for about 1 second.</span>
  <span class="p">}</span>

<span class="c1">//Analogue Stick readings</span>
  <span class="n">ForwardVal</span> <span class="o">=</span> <span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSS_RY</span><span class="p">);</span>
  <span class="n">YawLeftVal</span> <span class="o">=</span> <span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSS_RX</span><span class="p">);</span>
  <span class="n">UpVal</span> <span class="o">=</span> <span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSS_LY</span><span class="p">);</span>
  <span class="n">RollLeftVal</span> <span class="o">=</span> <span class="n">ps2x</span><span class="p">.</span><span class="n">Analog</span><span class="p">(</span><span class="n">PSS_LX</span><span class="p">);</span>

<span class="c1">//Translate the Stick readings to servo instructions</span>
<span class="c1">//This would normally happen in the ROV based on the</span>
<span class="c1">//Stick readings sent to it from the topside Arduino</span>
<span class="c1">//Over the serial.</span>
<span class="c1">//Readings from PS2 Controller Sticks are from 0 to 255</span>
<span class="c1">//with the neutral being 128.  The zero positions are to</span>
<span class="c1">//the left for X-axis movements and up for Y-axis movements.</span>

<span class="c1">//Variables to carry the actual raw data for the ESCs</span>
  <span class="n">upLraw</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="o">-</span><span class="n">UpVal</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">128</span><span class="o">-</span><span class="n">RollLeftVal</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>  <span class="c1">//This will be up to a value of 192 </span>
  <span class="n">upRraw</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="o">-</span><span class="n">UpVal</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mi">128</span><span class="o">-</span><span class="n">RollLeftVal</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>  <span class="c1">//This will be up to a value of 192</span>
  <span class="n">HLraw</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="o">-</span><span class="n">ForwardVal</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">128</span><span class="o">-</span><span class="n">YawLeftVal</span><span class="p">);</span>  <span class="c1">//This will be up to a value of 256</span>
  <span class="n">HRraw</span> <span class="o">=</span> <span class="p">(</span><span class="mi">128</span><span class="o">-</span><span class="n">ForwardVal</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="mi">128</span><span class="o">-</span><span class="n">YawLeftVal</span><span class="p">);</span>  <span class="c1">//This will be up to a value of 256</span>

<span class="c1">//Scale the values to be suitable for ESCs and Servos</span>
  <span class="n">upLraw</span><span class="o">=</span><span class="n">map</span><span class="p">(</span><span class="n">upLraw</span><span class="p">,</span><span class="o">-</span><span class="mi">193</span><span class="p">,</span><span class="mi">193</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">179</span><span class="p">);</span>
  <span class="n">upRraw</span><span class="o">=</span><span class="n">map</span><span class="p">(</span><span class="n">upRraw</span><span class="p">,</span><span class="o">-</span><span class="mi">193</span><span class="p">,</span><span class="mi">198</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">179</span><span class="p">);</span>
  <span class="n">HLraw</span><span class="o">=</span><span class="n">map</span><span class="p">(</span><span class="n">HLraw</span><span class="p">,</span><span class="o">-</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">179</span><span class="p">);</span>
  <span class="n">HRraw</span><span class="o">=</span><span class="n">map</span><span class="p">(</span><span class="n">HRraw</span><span class="p">,</span><span class="o">-</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">179</span><span class="p">);</span> 

<span class="c1">//Write it to the Servos or ESCs </span>

  <span class="n">UpLServo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">upLraw</span><span class="p">);</span>
  <span class="n">UpRServo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">upRraw</span><span class="p">);</span>
  <span class="n">HorizLServo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">HLraw</span><span class="p">);</span>
  <span class="n">HorizRServo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">HRraw</span><span class="p">);</span>

<span class="c1">// Signalling that a photo has been taken.</span>

  <span class="k">if</span><span class="p">(</span><span class="n">CamPhotoInd</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">CamPhotoInd</span> <span class="o">=</span> <span class="n">CamPhotoInd</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//countdown for the CamIndicator</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">grnLEDpin</span><span class="p">,</span><span class="n">HIGH</span><span class="p">);</span>  <span class="c1">//Light the Green LED to indicate phototriggered</span>
  <span class="p">}</span>
  <span class="k">if</span><span class="p">(</span><span class="n">CamPhotoInd</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">grnLEDpin</span><span class="p">,</span><span class="n">LOW</span><span class="p">);</span>  <span class="c1">//Photo event indication over.</span>
  <span class="p">}</span>

  <span class="n">CamPitch</span> <span class="o">=</span> <span class="n">constrain</span><span class="p">(</span><span class="n">CamPitch</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">149</span><span class="p">);</span> <span class="c1">//keep CamPitch within the 30 - 149 boundary</span>
  <span class="n">CamServo</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">CamPitch</span><span class="p">);</span>  <span class="c1">//Move the camera servo  </span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">redLEDpin</span><span class="p">,</span><span class="n">CamRec</span><span class="p">);</span> <span class="c1">//Light the redLED based on camera recording status flag</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">yelLEDpin</span><span class="p">,</span><span class="n">LEDHdlts</span><span class="p">);</span> <span class="c1">//Light the LED based on headlights status flag</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>	
      
      <h3 class="blogMeta">Par <a href="http://www.techmonkeybusiness.com/ps2-controller-sketch-for-escs-and-stuff.html#">Hamish Trolove</a>, Catégorie : <a href="http://www.techmonkeybusiness.com/category/tech-projects.html">Tech Projects</a></h3>
	<h3 class="blogMeta">Tags : <span><a href="http://www.techmonkeybusiness.com/tag/rov.html">ROV</a> / </span>
<span><a href="http://www.techmonkeybusiness.com/tag/arduino.html">Arduino</a> / </span>
<span><a href="http://www.techmonkeybusiness.com/tag/ps2.html">PS2</a> / </span>
<span><a href="http://www.techmonkeybusiness.com/tag/playstation.html">Playstation</a> / </span>
<span><a href="http://www.techmonkeybusiness.com/tag/esc.html">ESC</a> / </span>
<span><a href="http://www.techmonkeybusiness.com/tag/servo.html">Servo</a> / </span>
</h3>
    
    </div><!-- end #blogItem -->
				
				<!-- end #content -->
  
  </div><!-- end #mainContent -->

<div class="clearfloat"></div>

  <div id="footer">
     
    <p>Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>, which takes great advantages of <a href="http://python.org/">python</a>.
  </p></div><!-- end #footer -->

</div><!-- end #container -->

</body></html>